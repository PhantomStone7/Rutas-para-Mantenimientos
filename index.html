<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ruta de Entregas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100vw; }
        .delivered { background-color: green; color: white; padding: 5px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        var map = L.map('map', { zoomControl: true }).setView([13.3103, -87.1848], 12);
        
        L.tileLayer('https://{s}.tile.jawg.io/jawg-sunny/{z}/{x}/{y}{r}.png?access-token=nvyWYYOXIkVSjIb3dUHvOzMiPkhJSlcoiKcwnpRNDyJ8d24l3H4BNlAvODieirpq', {
            attribution: '&copy; <a href="https://www.jawg.io">Jawg Maps</a> contributors'
        }).addTo(map);

        var puntos = [
           { coords: [13.313413, -87.171042], name: "xplore rental car" },
            { coords: [13.292030, -87.178395], name: "avis rent car-hotel jicaral" },
            { coords: [13.313783, -87.192363], name: "Hotel gualiqueme" },
            { coords: [13.433341, -87.450421], name: "Pizza hut- el titan san lorenzo-payless-wendys" },
            { coords: [ 13.309638, -87.189355], name: "dominos pizza-miniso-jetstereo-beauty market" },
            { coords: [13.304453, -87.178921], name: "refripartes" },
            { coords: [13.302005, -87.198189], name: "intermedico" },
            { coords: [13.310200, -87.181027], name: "la colonia 15-acajoe-mendels" },
            { coords: [13.311541, -87.177092], name: "de todo-la bodega-sycom-optica curacao-wendys-sol en salsa-reino natural-navega-el titan-unipark-lady lee-calzado roy" },
            { coords: [13.309410, -87.180322], name: "Cafetano" },
            { coords: [13.310009, -87.184930], name: "el asador" },
            { coords: [13.297742, -87.185980], name: "rc lux hotel" },
            { coords: [13.297742, -87.185980], name: "farmacia ahorro hospital" },
            { coords: [13.303806, -87.118120], name: "Puma yusguare " },
            { coords: [13.592092, -87.747968], name: "China express" },
            { coords: [13.422584, -87.447230], name: "Molineros san lorenzo" },
            { coords: [13.303654, -87.178953], name: "Cemefa " },
            { coords: [13.298529, -87.195524], name: "Hotel victoria" },
            { coords: [13.307779, -87.190378], name: "Mega Automotriz" },
            { coords: [13.198752, -87.379499], name: "m y m monjaras-ultramotor" },
            { coords: [13.532007, -87.443269], name: "Fardisa" },
            { coords: [13.201208, -87.375277], name: "Motomundo" },
            { coords: [13.313556, -87.169777], name: "mini market imperio" },
            { coords: [13.422302, -87.447154], name: "La curacao cash san lorenzo" },
            { coords: [13.423772, -87.448190], name: "baco bar-demaro boutique" },
            { coords: [13.309938, -87.185433], name: "Hotel rivera" },
            { coords: [13.303493, -87.194207], name: "teccel" },
            { coords: [13.308409, -87.179217], name: "demaro boutique" },
            { coords: [13.310943, -87.177464], name: "punto farma" },
            { coords: [13.324075, -87.150680], name: "promaco vizcaya" },
            { coords: [13.306899, -87.178716], name: "dkache" },
            { coords: [13.431051, -87.449680], name: "pollolandia san lorenzo" },
            { coords: [13.412819, -87.442870], name: "anibals sanlo- la playa" },
            { coords: [13.302971, -87.187644], name: "lex honduras" },
            { coords: [13.319073, -87.158811], name: "Rapido cargo" },
            { coords: [13.304482, -87.194262], name: "Unithel" },
            { coords: [13.462942, -87.452829], name: "puma pacifico san lorenzo" },
            { coords: [13.294931, -87.185334], name: "clinica dr pablo martinez" },
            { coords: [13.605525, -87.368969], name: "tarta y cafe 2" },
            { coords: [13.305369, -87.191278], name: "foam de honduras" },
            { coords: [13.430249, -87.448093], name: "mega fardos" },
            { coords: [13.421574, -87.447287], name: "Farmacia diaz umanzor-vidafarma " },
            { coords: [13.311844, -87.174545], name: "puma suyapa-farmacia del ahorro 68" },
            { coords: [13.306247, -87.183383], name: "full audio" },
            { coords: [13.311554, -87.160336], name: "south international" },
            { coords: [13.312869, -87.171861], name: "repuestos del atlantico" },
            { coords: [13.303831, -87.182338], name: "nichas burguer" },
            { coords: [13.304279, -87.194724], name: "pacer" },
            { coords: [13.307703, -87.189816], name: "electrocontroles" },
            { coords: [13.290699, -87.178642], name: "Cemcol" },
            { coords: [13.311479, -87.177549], name: "sportlinekid-maggie-cat-dunkin-chesters-kali-tecnocomp-timeout-optica matamoros-unicines" },
            { coords: [13.311068, -87.178959], name: "Grupo Q" },
            { coords: [13.430543, -87.448595], name: "pinturas americanas" },
            { coords: [13.307289, -87.178944], name: "mega vivero" },
            { coords: [13.333173, -87.135954], name: "Herco ya " },
            { coords: [13.424647, -87.447101], name: "Texaco la cruz" },
            { coords: [13.430592, -87.448331], name: "alutech san lorenzo" },
            { coords: [13.433710, -87.450771], name: "tigo" },
            { coords: [13.316201, -87.161796], name: "pollisimo px02" },
            { coords: [13.422878, -87.447197], name: "tropigas" },
            { coords: [13.309362, -87.186558], name: "miralda studio" },
            { coords: [13.435479, -87.445600], name: "hotel y club morazan" },
            { coords: [13.293855, -87.153924], name: "bin depot" },
            { coords: [13.309968, -87.180696], name: "bombos" },
            { coords: [13.307961, -87.193480], name: "hotel baruch" },
            { coords: [13.425765, -87.446947], name: "ferreteria victoria" },
            { coords: [13.312677, -87.172371], name: "Cafeteria mana" },
            { coords: [13.310259, -87.178923], name: "Pupusas Miraflores" },
            { coords: [13.347608, -87.116486], name: "minimarket el barato" },
            { coords: [13.532706, -87.489906], name: "El gallo mas gallo nacaome" },
            { coords: [13.455440, -87.467888], name: "Sunrise school" },
            { coords: [13.307265, -87.185428], name: "Yego" },
            { coords: [13.311837, -87.176417], name: "Paiz" },
            { coords: [13.534697, -87.434795], name: "Uno jicaro" },
            { coords: [13.423348, -87.448016], name: "Ultra motor" },
            { coords: [13.315592, -87.164690], name: "Alutech" },
            { coords: [13.339982, -87.126620], name: "super empaques" },
             { coords: [13.311883, -87.174925], name: "ultramotor" },
            { coords: [13.306209, -87.189446], name: "Aire frio" },
            { coords: [13.308194, -87.189670], name: "Centrho" },
             { coords: [13.371598, -86.962990], name: "Puma el banquito" },
            { coords: [13.342917, -87.253038], name: "Puma santa elena" },
            { coords: [13.305402, -87.192513], name: "Areca" },
             { coords: [13.318210, -87.200994], name: "Cargill" },
            
        ];
   
        var markers = puntos.map((point, index) => {
            var marker = L.marker(point.coords).addTo(map);
            marker.bindPopup(`
                <label for='locationName${index}'>Nombre del Lugar:</label>
                <input type='text' id='locationName${index}' value='${point.name}' oninput='updateName(${index}, this.value)'><br>
                <button onclick='markDelivered(${index})'>Marcar como hecho</button>
            `);
            return marker;
        });

        function updateName(index, name) {
            puntos[index].name = name;
        }

        function markDelivered(index) {
            if (markers[index]) {
                map.removeLayer(markers[index]);
                markers[index] = null;
                updateRoute();
            }
        }

        var userMarker = null;
        var userPosition = null;
        var routeLine = null;

        function updateRoute() {
            if (!userPosition) return;
            var remainingPoints = markers.filter(marker => marker !== null).map(marker => marker.getLatLng());
            if (remainingPoints.length === 0) return;
            
            var coordinates = [[userPosition[1], userPosition[0]], ...remainingPoints.map(p => [p.lng, p.lat])].join(';');
            var osrmRouteUrl = `https://router.project-osrm.org/route/v1/driving/${coordinates}?overview=full&geometries=geojson`;
            
            fetch(osrmRouteUrl)
                .then(response => response.json())
                .then(data => {
                    if (routeLine) {
                        map.removeLayer(routeLine);
                    }
                    routeLine = L.polyline(data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]), {color: 'blue', weight: 5}).addTo(map);
                })
                .catch(error => console.error("Error obteniendo la ruta: ", error));
        }

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(position => {
                userPosition = [position.coords.latitude, position.coords.longitude];
                if (userMarker) {
                    userMarker.setLatLng(userPosition);
                } else {
                    userMarker = L.circle(userPosition, {radius: 50, color: 'red', fillColor: 'red', fillOpacity: 0.5}).addTo(map);
                }

                updateRoute();
            }, error => console.error("Error obteniendo la ubicación: ", error), { enableHighAccuracy: true });
        } else {
            alert("Geolocalización no soportada");
        }
    </script>
</body>
</html>
